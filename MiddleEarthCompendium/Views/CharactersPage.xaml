<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:MiddleEarthCompendium.ViewModels"
             xmlns:models="clr-namespace:Infrastructure.Models;assembly=Infrastructure"
             x:Class="MiddleEarthCompendium.Views.CharactersPage"
             x:DataType="viewmodels:CharactersViewModel">

    <Grid>
        <!-- Background Map -->
        <Image Source="middleearth.png" 
               Aspect="AspectFill"/>

        <!-- Content -->
        <Grid Padding="16" RowDefinitions="Auto,Auto,Auto,*">

            <!-- Title -->
            <Label Grid.Row="0"
                   Text="Characters"
                   FontFamily="Ringbearer"
                   FontSize="32"
                   TextColor="{StaticResource Primary}"
                   HorizontalOptions="Center"
                   Margin="0,0,0,8"/>

            <!-- Search Bar -->
            <Border Grid.Row="1"
                    BackgroundColor="{StaticResource CardBackground}"
                    Stroke="{StaticResource Primary}"
                    StrokeShape="RoundRectangle 8"
                    Padding="4"
                    Margin="0,0,0,8">
                <Entry Placeholder="Search characters..."
                       Text="{Binding SearchText}"
                       TextColor="{StaticResource TextPrimary}"
                       PlaceholderColor="{StaticResource TextSecondary}"/>
            </Border>

            <!-- Filters -->
            <Grid Grid.Row="2" ColumnDefinitions="*,*" ColumnSpacing="8" Margin="0,0,0,16">
                <!-- Race Filter -->
                <Border Grid.Column="0"
                        BackgroundColor="{StaticResource CardBackground}"
                        Stroke="{StaticResource Primary}"
                        StrokeShape="RoundRectangle 8"
                        Padding="8">
                    <Picker Title="Race"
                            ItemsSource="{Binding Races}"
                            SelectedItem="{Binding SelectedRace}"
                            TextColor="{StaticResource TextPrimary}"
                            TitleColor="{StaticResource TextSecondary}"/>
                </Border>

                <!-- Sort Order -->
                <Border Grid.Column="1"
                        BackgroundColor="{StaticResource CardBackground}"
                        Stroke="{StaticResource Primary}"
                        StrokeShape="RoundRectangle 8"
                        Padding="8">
                    <Picker Title="Sort"
                            ItemsSource="{Binding SortOptions}"
                            SelectedItem="{Binding SelectedSort}"
                            TextColor="{StaticResource TextPrimary}"
                            TitleColor="{StaticResource TextSecondary}"/>
                </Border>
            </Grid>

            <!-- Characters List -->
            <CollectionView Grid.Row="3"
                            ItemsSource="{Binding Characters}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Character">
                        <Border Margin="0,0,0,8" 
                                Padding="12" 
                                BackgroundColor="{StaticResource CardBackground}"
                                Stroke="{StaticResource Primary}"
                                StrokeShape="RoundRectangle 8">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:CharactersViewModel}}, Path=GoToDetailCommand}"
                                                      CommandParameter="{Binding .}"/>
                            </Border.GestureRecognizers>
                            <Grid ColumnDefinitions="*,Auto">
                                <VerticalStackLayout Grid.Column="0">
                                    <Label Text="{Binding Name}" 
                                           FontSize="18" 
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextPrimary}"/>
                                    <Label Text="{Binding Race}" 
                                           FontSize="14" 
                                           TextColor="{StaticResource TextSecondary}"/>
                                </VerticalStackLayout>
                                <Label Grid.Column="1" 
                                       Text="{Binding Gender}" 
                                       VerticalOptions="Center"
                                       TextColor="{StaticResource TextSecondary}"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center">
                        <Label Text="No characters found" 
                               FontSize="18" 
                               TextColor="{StaticResource TextSecondary}"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>

            <!-- Loading Indicator -->
            <ActivityIndicator Grid.RowSpan="4"
                               IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               Color="{StaticResource Primary}"/>
        </Grid>
    </Grid>

</ContentPage>